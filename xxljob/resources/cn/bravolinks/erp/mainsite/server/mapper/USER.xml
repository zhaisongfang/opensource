<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.bravolinks.erp.mainsite.server.dao.USER_DAO">
   <resultMap id="BaseResultMap" type="cn.bravolinks.erp.mainsite.server.model.User">
  </resultMap>
  
 
  <!-- 查询ERP所有人员信息 getAllOrgUser -->
  <select id="getAllOrgUser" resultType="cn.bravolinks.erp.mainsite.server.model.User" >
     select u.userid,
       u.username name,
       u.position_name position,
       u.mobile,
       u.email,
       d.departmentname,
       ((select departmentname
	          from orgdepartment
	         where id = d.parentdepartmentid) || '/' || d.departmentname) bmqc
	  from orguser u
	 inner join orgdepartment d on u.departmentid = d.id
	                           and d.companyid = 1
	                           and u.disenable = 0
  </select>
  <!-- 根据部门id查询部门下的人员 getUsersByID -->
  <select id="getUsersByID" parameterType="int" resultType="cn.bravolinks.erp.mainsite.server.model.User" >
     select userid, username name, position_name position, mobile, email
	  from orguser
	 where departmentid = #{id}
	   and disenable = 0
  </select>
  
  <!-- 根据部门id查询子部门getDeptsByID -->
  <select id="getDeptsByID" parameterType="int" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
     select id, departmentname as name, parentdepartmentid as parentid
	  from orgdepartment
	 where companyid = 1 and parentdepartmentid = #{id}
  </select>
  
  <!-- 查询ERP组织架构部门根部门getRootDept -->
  <select id="getRootDeptById" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
     SELECT  b.id, b.departmentname as name FROM ORGDEPARTMENT b  LEFT JOIN BO_CYTS_COMPANY A ON b.parentdepartmentid = A .gsid
			where  b.parentdepartmentid=#{id}
  </select>
  <!-- 查询ERP组织架构部门根部门getRootDeptById -->
  <select id="getRootDept" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
     select id, departmentname as name, parentdepartmentid as parentid
	  from orgdepartment
	 where companyid = 1 and parentdepartmentid = 0
  </select>
  
  <select id="getUserExtByUserid" parameterType="string" resultMap="BaseResultMap">
  	 	select u.userid,
	          u.username as name
	  from orguser u
	 inner join orgdepartment d on d.id = u.departmentid
	 inner join BO_ORG_EXT_DEPT e on e.departmentid = d.id
	 inner join BO_CYTS_COMPANY c on c.gsdm = e.gsdm
	 where u.userid = #{userid}
  </select>
  
    <!-- 根据部门id查询公司代码和公司名称 -->
  <select id="getGS" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
    select GSMC as name , gsdm  from BO_ORG_EXT_DEPT where DEPARTMENTID=#{id}
								
  </select>
  
      <!-- 部门总监姓名和账户 -->
  <select id="getUser" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
    select USERID as userid,USERNAME as name from orguser where roleid=188597 
	and departmentid =#{0}  union select USERID as userid,USERNAME as name from orguser where id in 
	(select mapid from orgusermap where roleid=188597 and departmentid =#{0})
								
  </select>
  
        <!-- 根据名字查询gsdm -->
  <select id="getUserGSDM" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
   select gsdm from BO_ORG_EXT_DEPT where departmentid in (select departmentid from ORGUSER where userid = #{0})
								
  </select>
  
         <!-- 根据gsdm 查询GSMC-->
  <select id="getGsdmGSMC" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
   select DEPARTMENTNAME AS name from ORGDEPARTMENT where departmentno=#{0}
								
								
  </select>
          <!-- 根据客户编号查询bmid-->
  <select id="getKhBMID" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
   select DEPARTMENTID as gsdm  from orguser where userid = #{0}
								
								
  </select>
  
          <!-- 根据GSID 查询name-->
  <select id="getGsdmGSID" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
  	 select DEPARTMENTNAME as name from ORGDEPARTMENT where id=#{0}							
								
  </select>
          <!-- 根据szbmid查询代码-->
  <select id="getBMidGS" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
  	 select GSDM from BO_ORG_EXT_DEPT where DEPARTMENTID =#{0}							
								
  </select>
          <!-- 根据部门代码 查询公司名称-->
  <select id="getBMidGSID" resultType="cn.bravolinks.erp.mainsite.server.model.Dept" >
  	select GSMC as name  from BO_ORG_EXT_DEPT where DEPARTMENTID ==#{0}							
								
  </select>
           <!-- 根据userid 查询username-->
  <select id="getUserName" parameterType="java.lang.String" resultType="java.lang.String">
   		select  username from orguser where userid=#{userid}
   </select>
 
 <!-- 查询ERP所有人员信息 getAllOrgUser -->
  <select id="getcomAndDepartment" parameterType="java.lang.String" resultType="java.lang.String" >
     select 
       ((select departmentname
	          from orgdepartment
	         where id = d.parentdepartmentid) || '/' || d.departmentname) bmqc
	  from orguser u 
	 inner join orgdepartment d on u.departmentid = d.id
	                           and d.companyid = 1
	                           and u.disenable = 0 where u.userid=#{userid}
  </select>
     <!-- 查询所有员工 -->
	  <select id="searchSPR" resultType="map" parameterType="map">
	     select temp.* from (
	     	select u.userid,
	       u.username name,
	       d.departmentname
		  from orguser u
		 inner join orgdepartment d on u.departmentid = d.id
		                           and d.companyid = 1
		                           and u.disenable = 0
	     where u.DISENABLE=0 ) temp where temp.userid !=#{userid} 
	     <if test="searchVal != null and searchVal != ''">
   			and temp.name like concat('%',concat(#{searchVal},'%'))  or temp.departmentname like concat('%',concat(#{searchVal},'%'))
   		 </if>
	  </select>
</mapper>